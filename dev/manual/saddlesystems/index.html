<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Saddle point systems · ConstrainedSystems.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ConstrainedSystems.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li class="is-active"><a class="tocitem" href>Saddle point systems</a><ul class="internal"><li><a class="tocitem" href="#Translating-cylinder-in-potential-flow"><span>Translating cylinder in potential flow</span></a></li></ul></li><li><a class="tocitem" href="../timemarching/">Time marching</a></li><li><a class="tocitem" href="../methods/">Index</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Saddle point systems</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Saddle point systems</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaIBPM/ConstrainedSystems.jl/blob/master/docs/src/manual/saddlesystems.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Saddle-point-systems"><a class="docs-heading-anchor" href="#Saddle-point-systems">Saddle point systems</a><a id="Saddle-point-systems-1"></a><a class="docs-heading-anchor-permalink" href="#Saddle-point-systems" title="Permalink"></a></h1><p class="math-container">\[\def\ddt#1{\frac{\mathrm{d}#1}{\mathrm{d}t}}

\renewcommand{\vec}{\boldsymbol}
\newcommand{\uvec}[1]{\vec{\hat{#1}}}
\newcommand{\utangent}{\uvec{\tau}}
\newcommand{\unormal}{\uvec{n}}

\renewcommand{\d}{\,\mathrm{d}}\]</p><p>Saddle systems comprise an important part of solving mechanics problems with constraints. In such problems, there is an underlying system to solve, and the addition of constraints requires that the system is subjected to additional forces (constraint forces, or Lagrange multipliers) that enforce these constraints in the system. Examples of such constrained systems are the divergence-free velocity constraint in incompressible flow (for which pressure is the associated Lagrange multiplier field), the no-slip and/or no-flow-through condition in general fluid systems adjacent to impenetrable bodies, and joint constraints in rigid-body mechanics.</p><p>A general saddle-point system has the form</p><p class="math-container">\[\left[ \begin{array}{cc} A &amp; B_1^T \\ B_2 &amp; C\end{array}\right] \left(\begin{array}{c}u\\f \end{array}\right) = \left(\begin{array}{c}r_1\\r_2 \end{array}\right)\]</p><p>We are primarily interested in cases when the operator <span>$A$</span> is symmetric and positive semi-definite, which is fairly typical. It is also fairly common for <span>$B_1 = B_2$</span>, so that the whole system is symmetric.</p><p><code>ConstrainedSystems</code> allows us to solve such systems for <span>$u$</span> and <span>$f$</span> in a fairly easy way. We need only to provide rules for how to evaluate the actions of the various operators in the system. Let us use an example to show how this can be done.</p><h2 id="Translating-cylinder-in-potential-flow"><a class="docs-heading-anchor" href="#Translating-cylinder-in-potential-flow">Translating cylinder in potential flow</a><a id="Translating-cylinder-in-potential-flow-1"></a><a class="docs-heading-anchor-permalink" href="#Translating-cylinder-in-potential-flow" title="Permalink"></a></h2><p>In irrotational, incompressible flow, the streamfunction <span>$\psi$</span> satisfies Laplace&#39;s equation,</p><p class="math-container">\[\nabla^2 \psi = 0\]</p><p>On the surface of an impenetrable body, the streamfunction must obey the constraint</p><p class="math-container">\[\psi = \psi_b\]</p><p>where <span>$\psi_b$</span> is the streamfunction associated with the body&#39;s motion. Let us suppose the body is moving vertically with velocity 1. Then <span>$\psi_b = -x$</span> for all points inside or on the surface of the body. Thus, the streamfunction field outside this body is governed by Laplace&#39;s equation subject to the constraint.</p><p>Let us solve this problem on a staggered grid, using the tools discussed in <a href="https://juliaibpm.github.io/CartesianGrids.jl/latest/">CartesianGrids</a>, including the regularization and interpolation methods to immerse the body shape on the grid. Then our saddle-point system has the form</p><p class="math-container">\[\left[ \begin{array}{cc} L &amp; R \\ E &amp; 0\end{array}\right] \left(\begin{array}{c}\psi\\f \end{array}\right) = \left(\begin{array}{c}0\\\psi_b \end{array}\right)\]</p><p>where <span>$L$</span> is the discrete Laplacian, <span>$R$</span> is the regularization operator, and <span>$E$</span> is the interpolation operator.</p><p>Physically, <span>$f$</span> isn&#39;t really a force here, but rather, represents the strengths of distributed singularities on the surface. In fact, this strength represents the jump in normal derivative of <span>$\psi$</span> across the surface. Since this normal derivative is equivalent to the tangential velocity, <span>$f$</span> is the strength of the bound vortex sheet on the surface. This will be useful to know when we check the value of <span>$f$</span> obtained in our solution.</p><p>First, let us set up the body, centered at <span>$(1,1)$</span> and of radius <span>$1/2$</span>. We will also initialize a data structure for the force:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; n = 128; θ = range(0,stop=2π,length=n+1);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; xb = 1.0 .+ 0.5*cos.(θ[1:n]); yb = 1.0 .+ 0.5*sin.(θ[1:n]);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; X = VectorData(xb,yb);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ψb = ScalarData(X);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; f = similar(ψb);</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Now let&#39;s set up a grid of size <span>$102\times 102$</span> (including the usual layer of ghost cells) and physical dimensions <span>$2\times 2$</span>.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; nx = 102; ny = 102; Lx = 2.0; dx = Lx/(nx-2);</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; w = Nodes(Dual,(nx,ny));</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; ψ = similar(w);</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>We need to set up the operators now. First, the Laplacian:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; L = plan_laplacian(size(w),with_inverse=true)</code><code class="nohighlight hljs ansi" style="display:block;">Discrete Laplacian (and inverse) on a (nx = 102, ny = 102) grid acting on Float64 data with
               factor 1.0 and spacing 1.0</code></pre><p>Note that we have made sure that this operator has an inverse. It is important that this operator, which represents the <code>A</code> matrix in our saddle system, comes with an associated backslash <code>\\</code> operation to carry out the inverse.</p><p>Now we need to set up the regularization <code>R</code> and interpolation <code>E</code> operators.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; regop = Regularize(X,dx;issymmetric=true)</code><code class="nohighlight hljs ansi" style="display:block;">Symmetric regularization/interpolation operator with non-filtered interpolation
  DDF type CartesianGrids.Yang3
  128 points in grid with cell area 0.0004</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; Rmat, Emat = RegularizationMatrix(regop,ψb,w);</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Now we are ready to set up the system. The solution and right-hand side vectors are set up using <code>SaddleVector</code>.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; rhs = SaddleVector(w,ψb)</code><code class="nohighlight hljs ansi" style="display:block;">(CartesianGrids.Dual nodes in a (nx = 102, ny = 102) cell grid of type Float64 data
  Number of CartesianGrids.Dual nodes: (nx = 102, ny = 102), [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0])</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; sol = SaddleVector(ψ,f)</code><code class="nohighlight hljs ansi" style="display:block;">(CartesianGrids.Dual nodes in a (nx = 102, ny = 102) cell grid of type Float64 data
  Number of CartesianGrids.Dual nodes: (nx = 102, ny = 102), [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0])</code></pre><p>and the saddle system is then set up with the three operators; the <span>$C$</span> operator is presumed to be zero when it is not provided.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; A = SaddleSystem(L,Emat,Rmat,rhs)</code><code class="nohighlight hljs ansi" style="display:block;">Saddle system with 10404 states and 128 constraints and
   State vector of type CartesianGrids.Nodes{CartesianGrids.Dual, 102, 102, Float64, Matrix{Float64}}
   Constraint vector of type CartesianGrids.ScalarData{128, Float64, Vector{Float64}}
   Elements of type Float64
using a Direct solver</code></pre><p>Note that all of the operators we have provided are either matrices (like <code>Emat</code> and <code>Rmat</code>) or functions or function-like operators (like <code>L</code>). The <code>SaddleSystem</code> constructor allows either. However, the order is important: we must supply <span>$A$</span>, <span>$B_2$</span>, <span>$B_1^T$</span>, and possibly <span>$C$</span>, in that order.</p><p>Let&#39;s solve the system. We need to set the right-hand side. We will set <code>ψb</code>, but this will also change <code>rhs</code>, since that vector is pointing to the same object.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; ψb .= -(xb.-1);</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>The right-hand side of the Laplace equation is zero. The right-hand side of the constraint is the specified streamfunction on the body. Note that we have subtracted the circle center from the <span>$x$</span> positions on the body. The reason for this will be discussed in a moment.</p><p>We solve the system with the convenient shorthand of the backslash:</p><pre><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; @time sol .= A\rhs</code><code class="nohighlight hljs ansi" style="display:block;">  0.003464 seconds (212 allocations: 504.766 KiB)
(CartesianGrids.Dual nodes in a (nx = 102, ny = 102) cell grid of type Float64 data
  Number of CartesianGrids.Dual nodes: (nx = 102, ny = 102), [-0.04977243011213668, -0.050629950442595814, -0.05000226127763451, -0.050317009359110786, -0.04827965305847172, -0.04858716451914609, -0.04982002319139934, -0.04520058738452757, -0.04882906345775002, -0.04350404395267875  …  -0.046350751558960714, -0.0435040439526704, -0.04882906345775434, -0.0452005873845186, -0.04982002319141662, -0.04858716451913345, -0.04827965305847681, -0.05031700935910286, -0.050002261277644046, -0.050629950442591755])</code></pre><p>Just to point out how fast it can be, we have also timed it. It&#39;s pretty fast.</p><p>We can obtain the state vector and the constraint vector from <code>sol</code> using some convenience functions <code>state(sol)</code> and <code>constraint(sol)</code>.</p><p>Now, let&#39;s plot the solution in physical space. We&#39;ll plot the body shape for reference, also.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; xg, yg = coordinates(w,dx=dx)</code><code class="nohighlight hljs ansi" style="display:block;">(-0.01:0.02:2.0100000000000002, -0.01:0.02:2.0100000000000002)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; plot(xg,yg,state(sol),xlim=(-Inf,Inf),ylim=(-Inf,Inf))</code><code class="nohighlight hljs ansi" style="display:block;">Plot{Plots.PyPlotBackend() n=1}</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; plot!(xb,yb,fillcolor=:black,fillrange=0,fillalpha=0.25,linecolor=:black)</code><code class="nohighlight hljs ansi" style="display:block;">Plot{Plots.PyPlotBackend() n=2}</code><code class="nohighlight hljs ansi" style="display:block;">sys:1: UserWarning: The following kwargs were not used by contour: &#39;label&#39;</code></pre><p><img src="../sfunc.svg" alt/></p><p>The solution shows the streamlines for a circle in vertical motion, as expected. All of the streamlines inside the circle are vertical.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../timemarching/">Time marching »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.7 on <span class="colophon-date" title="Friday 1 October 2021 22:36">Friday 1 October 2021</span>. Using Julia version 1.6.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
