<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Saddle point systems · ConstrainedSystems.jl</title><meta name="title" content="Saddle point systems · ConstrainedSystems.jl"/><meta property="og:title" content="Saddle point systems · ConstrainedSystems.jl"/><meta property="twitter:title" content="Saddle point systems · ConstrainedSystems.jl"/><meta name="description" content="Documentation for ConstrainedSystems.jl."/><meta property="og:description" content="Documentation for ConstrainedSystems.jl."/><meta property="twitter:description" content="Documentation for ConstrainedSystems.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ConstrainedSystems.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li class="is-active"><a class="tocitem" href>Saddle point systems</a><ul class="internal"><li><a class="tocitem" href="#Translating-cylinder-in-potential-flow"><span>Translating cylinder in potential flow</span></a></li></ul></li><li><a class="tocitem" href="../timemarching/">Time marching</a></li><li><a class="tocitem" href="../methods/">Index</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Saddle point systems</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Saddle point systems</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/ConstrainedSystems.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaIBPM/ConstrainedSystems.jl/blob/master/test/literate/saddlesystems.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Saddle-point-systems"><a class="docs-heading-anchor" href="#Saddle-point-systems">Saddle point systems</a><a id="Saddle-point-systems-1"></a><a class="docs-heading-anchor-permalink" href="#Saddle-point-systems" title="Permalink"></a></h1><p class="math-container">\[\def\ddt#1{\frac{\mathrm{d}#1}{\mathrm{d}t}}
\renewcommand{\vec}{\boldsymbol}
\newcommand{\uvec}[1]{\vec{\hat{#1}}}
\newcommand{\utangent}{\uvec{\tau}}
\newcommand{\unormal}{\uvec{n}}
\renewcommand{\d}{\,\mathrm{d}}\]</p><p>Saddle systems comprise an important part of solving mechanics problems with constraints. In such problems, there is an underlying system to solve, and the addition of constraints requires that the system is subjected to additional forces (constraint forces, or Lagrange multipliers) that enforce these constraints in the system. Examples of such constrained systems are the divergence-free velocity constraint in incompressible flow (for which pressure is the associated Lagrange multiplier field), the no-slip and/or no-flow-through condition in general fluid systems adjacent to impenetrable bodies, and joint constraints in rigid-body mechanics.</p><p>A general saddle-point system has the form</p><p class="math-container">\[\left[ \begin{array}{cc} A &amp; B_1^T \\ B_2 &amp; C\end{array}\right] \left(\begin{array}{c}u\\f \end{array}\right) = \left(\begin{array}{c}r_1\\r_2 \end{array}\right)\]</p><p>We are primarily interested in cases when the operator <span>$A$</span> is symmetric and positive semi-definite, which is fairly typical. It is also fairly common for <span>$B_1 = B_2$</span>, so that the whole system is symmetric.</p><p><a href="https://github.com/JuliaIBPM/ConstrainedSystems.jl">ConstrainedSystems.jl</a> allows us to solve such systems for <span>$u$</span> and <span>$f$</span> in a fairly easy way. We need only to provide rules for how to evaluate the actions of the various operators in the system. Let us use an example to show how this can be done.</p><pre><code class="language-julia hljs">using ConstrainedSystems
using CartesianGrids
using Plots</code></pre><h2 id="Translating-cylinder-in-potential-flow"><a class="docs-heading-anchor" href="#Translating-cylinder-in-potential-flow">Translating cylinder in potential flow</a><a id="Translating-cylinder-in-potential-flow-1"></a><a class="docs-heading-anchor-permalink" href="#Translating-cylinder-in-potential-flow" title="Permalink"></a></h2><p>In irrotational, incompressible flow, the streamfunction <span>$\psi$</span> satisfies Laplace&#39;s equation,</p><p class="math-container">\[\nabla^2 \psi = 0\]</p><p>On the surface of an impenetrable body, the streamfunction must obey the constraint</p><p class="math-container">\[\psi = \psi_b\]</p><p>where <span>$\psi_b$</span> is the streamfunction associated with the body&#39;s motion. Let us suppose the body is moving vertically with velocity 1. Then <span>$\psi_b = -x$</span> for all points inside or on the surface of the body. Thus, the streamfunction field outside this body is governed by Laplace&#39;s equation subject to the constraint.</p><p>Let us solve this problem on a staggered grid, using the tools discussed in <a href="https://juliaibpm.github.io/CartesianGrids.jl/latest/">CartesianGrids</a>, including the regularization and interpolation methods to immerse the body shape on the grid. Then our saddle-point system has the form</p><p class="math-container">\[\left[ \begin{array}{cc} L &amp; R \\ E &amp; 0\end{array}\right] \left(\begin{array}{c}\psi\\f \end{array}\right) = \left(\begin{array}{c}0\\\psi_b \end{array}\right)\]</p><p>where <span>$L$</span> is the discrete Laplacian, <span>$R$</span> is the regularization operator, and <span>$E$</span> is the interpolation operator.</p><p>Physically, <span>$f$</span> isn&#39;t really a force here, but rather, represents the strengths of distributed singularities on the surface. In fact, this strength represents the jump in normal derivative of <span>$\psi$</span> across the surface. Since this normal derivative is equivalent to the tangential velocity, <span>$f$</span> is the strength of the bound vortex sheet on the surface. This will be useful to know when we check the value of <span>$f$</span> obtained in our solution.</p><p>First, let us set up the body, centered at <span>$(1,1)$</span> and of radius <span>$1/2$</span>. We will also initialize a data structure for the force:</p><pre><code class="language-julia hljs">n = 128; θ = range(0,stop=2π,length=n+1);
xb = 1.0 .+ 0.5*cos.(θ[1:n]); yb = 1.0 .+ 0.5*sin.(θ[1:n]);
X = VectorData(xb,yb);
ψb = ScalarData(X);
f = similar(ψb);</code></pre><p>Now let&#39;s set up a grid of size <span>$102\times 102$</span> (including the usual layer of ghost cells) and physical dimensions <span>$2\times 2$</span>.</p><pre><code class="language-julia hljs">nx = 102; ny = 102; Lx = 2.0; dx = Lx/(nx-2);
w = Nodes(Dual,(nx,ny));
ψ = similar(w);</code></pre><p>We need to set up the operators now. First, the Laplacian:</p><pre><code class="language-julia hljs">L = plan_laplacian(size(w),with_inverse=true)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Discrete Laplacian (and inverse) on a (nx = 102, ny = 102) grid acting on Float64 data with
               factor 1.0 and spacing 1.0</code></pre><p>Note that we have made sure that this operator has an inverse. It is important that this operator, which represents the <code>A</code> matrix in our saddle system, comes with an associated backslash <code>\\</code> operation to carry out the inverse.</p><p>Now we need to set up the regularization <code>R</code> and interpolation <code>E</code> operators.</p><pre><code class="language-julia hljs">regop = Regularize(X,dx;issymmetric=true)
Rmat, Emat = RegularizationMatrix(regop,ψb,w);</code></pre><p>Now we are ready to set up the system. The solution and right-hand side vectors are set up using <code>SaddleVector</code>.</p><pre><code class="language-julia hljs">rhs = SaddleVector(w,ψb)
sol = SaddleVector(ψ,f)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(CartesianGrids.Dual nodes in a (nx = 102, ny = 102) cell grid of type Float64 data
  Number of CartesianGrids.Dual nodes: (nx = 102, ny = 102), [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0  …  0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0])</code></pre><p>and the saddle system is then set up with the three operators; the <span>$C$</span> operator is presumed to be zero when it is not provided.</p><pre><code class="language-julia hljs">A = SaddleSystem(L,Emat,Rmat,rhs)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Saddle system with 10404 states and 128 constraints and
   State vector of type CartesianGrids.Nodes{CartesianGrids.Dual, 102, 102, Float64, Matrix{Float64}}
   Constraint vector of type CartesianGrids.ScalarData{128, Float64, Vector{Float64}}
   Elements of type Float64
using a Direct solver
</code></pre><p>Note that all of the operators we have provided are either matrices (like <code>Emat</code> and <code>Rmat</code>) or functions or function-like operators (like <code>L</code>). The <code>SaddleSystem</code> constructor allows either. However, the order is important: we must supply <span>$A$</span>, <span>$B_2$</span>, <span>$B_1^T$</span>, and possibly <span>$C$</span>, in that order.</p><p>Let&#39;s solve the system. We need to set the right-hand side. We will set <code>ψb</code>, but this will also change <code>rhs</code>, since that vector is pointing to the same object.</p><pre><code class="language-julia hljs">ψb .= -(xb.-1);</code></pre><p>The right-hand side of the Laplace equation is zero. The right-hand side of the constraint is the specified streamfunction on the body. Note that we have subtracted the circle center from the <span>$x$</span> positions on the body. The reason for this will be discussed in a moment.</p><p>We solve the system with the convenient shorthand of the backslash:</p><pre><code class="language-julia hljs">@time sol .= A\rhs</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(CartesianGrids.Dual nodes in a (nx = 102, ny = 102) cell grid of type Float64 data
  Number of CartesianGrids.Dual nodes: (nx = 102, ny = 102), [-0.049772430112140074, -0.05062995044259838, -0.05000226127762835, -0.050317009359113075, -0.04827965305847634, -0.04858716451913709, -0.0498200231914067, -0.04520058738451927, -0.048829063457766546, -0.04350404395265777  …  -0.04635075155896142, -0.04350404395267087, -0.04882906345775148, -0.045200587384523996, -0.04982002319140999, -0.048587164519136326, -0.048279653058478485, -0.05031700935910287, -0.05000226127764162, -0.0506299504425909])</code></pre><p>Just to point out how fast it can be, we have also timed it. It&#39;s pretty fast.</p><p>We can obtain the state vector and the constraint vector from <code>sol</code> using some convenience functions <code>state(sol)</code> and <code>constraint(sol)</code>.</p><p>Now, let&#39;s plot the solution in physical space. We&#39;ll plot the body shape for reference, also.</p><pre><code class="language-julia hljs">xg, yg = coordinates(w,dx=dx)
plot(xg,yg,state(sol),xlim=(-Inf,Inf),ylim=(-Inf,Inf))
plot!(xb,yb,fillcolor=:black,fillrange=0,fillalpha=0.25,linecolor=:black)</code></pre><img src="c5c11267.svg" alt="Example block output"/><p>The solution shows the streamlines for a circle in vertical motion, as expected. All of the streamlines inside the circle are vertical.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../timemarching/">Time marching »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.6.0 on <span class="colophon-date" title="Thursday 29 August 2024 22:34">Thursday 29 August 2024</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
